DROP DATABASE IF EXISTS CRIMINALES_POLICIA;
CREATE DATABASE IF NOT EXISTS CRIMINALES_POLICIA; -- CREAMOS LA BASE DE DATOS LLAMADA CRIMINALES_POLICIA
USE CRIMINALES_POLICIA; -- LA SELECCIONAMOS PARA TRABAJAR CON ELLA

-- Crear la tabla BANDAS con clave primaria
CREATE TABLE IF NOT EXISTS BANDAS (
    IdBanda INT NOT NULL PRIMARY KEY, -- EL ID BANDA SERIA EL EQUIVALENTE A UN NºEXPEDIENTE POLICIAL
    Nombre VARCHAR(50),
    Ciudad VARCHAR(50),
    CodigoPostal VARCHAR(10)
);

-- Crear la tabla MIEMBROS
CREATE TABLE IF NOT EXISTS MIEMBROS (
    DNI VARCHAR(9) PRIMARY KEY,
    Nombre VARCHAR(50),
    Apellido VARCHAR(50),
    IDJefe VARCHAR(9) NULL,
    IdBanda INT NOT NULL,
    FOREIGN KEY (IdBanda) REFERENCES BANDAS(IdBanda) ON DELETE CASCADE
);

-- Crear la tabla DELITOS
CREATE TABLE IF NOT EXISTS DELITOS (
    IdDelito INT PRIMARY KEY,
    TipoDelito VARCHAR(50),
    FechaDelito DATE,
    CiudadDelito VARCHAR(50),
    IdBanda INT NOT NULL,
    FOREIGN KEY (IdBanda) REFERENCES BANDAS(IdBanda) ON DELETE CASCADE
);

-- Crear la tabla VICTIMAS
CREATE TABLE IF NOT EXISTS VICTIMAS (
    DNI VARCHAR(9) PRIMARY KEY,
    Nombre VARCHAR(50),
    Apellido VARCHAR(50),
    Direccion VARCHAR(100),
    Edad INT,
    Sexo VARCHAR(6)
);

-- Crear la tabla de la relación N:M entre MIEMBROS y DELITOS
CREATE TABLE IF NOT EXISTS MIEMBROS_DELITOS (
    DNI VARCHAR(9),
    IdDelito INT,
    PRIMARY KEY (DNI, IdDelito),
    FOREIGN KEY (DNI) REFERENCES MIEMBROS(DNI) ON DELETE CASCADE,
    FOREIGN KEY (IdDelito) REFERENCES DELITOS(IdDelito) ON DELETE CASCADE
);

-- Crear la tabla de la relación N:M entre DELITOS y VÍCTIMAS
CREATE TABLE IF NOT EXISTS DELITOS_VICTIMAS (
    IdDelito INT,
    DNI VARCHAR(9),
    PRIMARY KEY (IdDelito, DNI),
    FOREIGN KEY (IdDelito) REFERENCES DELITOS(IdDelito) ON DELETE CASCADE,
    FOREIGN KEY (DNI) REFERENCES VICTIMAS(DNI) ON DELETE CASCADE
);

INSERT INTO BANDAS (IdBanda, Nombre, Ciudad, CodigoPostal) 
VALUES 
(3, 'Los Chanchos', 'Valencia', '15247'),
(4, 'Los Hooligans', 'Sevilla', '85247'),
(5, 'Los Termitas', 'Bilbao', '98745'),
(6, 'Los Ultazur', 'Zaragoza', '50142');

INSERT INTO MIEMBROS (DNI, Nombre, Apellido, IDJefe, IdBanda) 
VALUES 
('34567891E', 'Miguel', 'Sánchez', NULL, 3),  
('45678902F', 'Javier', 'López', '56789013G', 4),     
('56789013G', 'Andrés', 'Martínez', NULL, 4),         
('67890124H', 'Pedro', 'García', '34567891E', 3);    

INSERT INTO DELITOS (IdDelito, TipoDelito, FechaDelito, CiudadDelito, IdBanda) 
VALUES 
(3, 'Extorsión', '2024-02-10', 'Valencia', 3),        
(4, 'Contrabando', '2023-11-20', 'Sevilla', 4),       
(5, 'Vandalismo', '2024-01-05', 'Bilbao', 5),         
(6, 'Robo de vehículos', '2023-12-15', 'Zaragoza', 6);

INSERT INTO VICTIMAS (DNI, Nombre, Apellido, Direccion, Edad, Sexo) 
VALUES 
('56789012F', 'Laura', 'García', 'Calle Mayor 10, Valencia', 28, 'F'),   
('67890123G', 'Ricardo', 'López', 'Avenida Central 23, Sevilla', 40, 'M'), 
('78901234H', 'María', 'Santos', 'Plaza Nueva 5, Bilbao', 32, 'F'),      
('89012345I', 'Fernando', 'Ruiz', 'Calle Real 18, Zaragoza', 50, 'M');

INSERT INTO MIEMBROS_DELITOS (DNI, IdDelito) 
VALUES 
('34567891E', 3),  
('45678902F', 4),  
('56789013G', 5),  
('67890124H', 6);  

INSERT INTO DELITOS_VICTIMAS (IdDelito, DNI) 
VALUES 
(3, '56789012F'),  
(4, '67890123G'),  
(5, '78901234H'),  
(6, '89012345I');

SELECT * FROM BANDAS;

SELECT NOMBRE FROM CLIENTES C WHERE EXISTS (SELECT 1 FROM PEDIDOS P WHERE P.CLIENTE_ID = C.CLIENTES_ID AND P.IMPORTE > 5000);
SELECT J.NOMBRE AS JEFE, S.NOMBRE AS MIEMBROS 
FROM EPLEADO AS J 
INNER JOIN EMPLEADO AS S 
ON J.IDEMPLEADO = S.JEFE;
SELECT J.NOMBRE AS JEFE, S.NOMBRE AS MIEMBROS FROM EPLEADO AS J INNER JOIN EMPLEADO AS S ON J.IDEMPLEADO = S.JEFE WHERE J.NOMBRE="lUCAS";
SELECT IDEMPLEADO, NOMBRE FROM EMPLEADO WHERE IDEMPLEADO IN(SELECT JEFE FROM EMPLEADO); -- PARA VER QUIENES SON LOS JEFES
